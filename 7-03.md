# Домашнее задание к занятию «Подъём инфраструктуры в Yandex Cloud»
---

### Задание 1 

Повторить демонстрацию лекции(развернуть vpc, 2 веб сервера, бастион сервер)

#### Ответ:

#### Скриншот:

![1](https://github.com/yojihc/netology-Virtualization/blob/7-03/pics/01.png?raw=true)

#### Скриншот:

![2](https://github.com/yojihc/netology-Virtualization/blob/7-03/pics/02.png?raw=true)

#### Скриншот:

![3](https://github.com/yojihc/netology-Virtualization/blob/7-03/pics/03.png?raw=true)

#### Скриншот:

![4](https://github.com/yojihc/netology-Virtualization/blob/7-03/pics/04.png?raw=true)

#### Скриншот:

![5](https://github.com/yojihc/netology-Virtualization/blob/7-03/pics/05.png?raw=true)

### Задание 2 

С помощью ansible подключиться к web-a и web-b , установить на них nginx.(написать нужный ansible playbook)


Провести тестирование и приложить скриншоты развернутых в облаке ВМ, успешно отработавшего ansible playbook. 

#### Ответ:

#### Code:

```yaml
---
- name: test
  gather_facts: false
  hosts: webservers
  gather_facts: true
  vars:
    ansible_ssh_user: user
  become: yes

  tasks:
    - name: Gather facts about remote hosts
      setup:  

    - name: Update apt cache
      apt:
        update_cache: yes
      when: ansible_os_family == 'Debian'

    - name: Install Nginx
      package:
        name: nginx
        state: present
      notify: restart nginx

  handlers:
    - name: restart nginx
      service:
        name: nginx
        state: restarted
```

#### Скриншот:

![6](https://github.com/yojihc/netology-Virtualization/blob/7-03/pics/06.png?raw=true)

#### Скриншот:

![7](https://github.com/yojihc/netology-Virtualization/blob/7-03/pics/07.png?raw=true)

---

## Дополнительные задания* (со звёздочкой)

Их выполнение необязательное и не влияет на получение зачёта по домашнему заданию. Можете их решить, если хотите глубже и/или шире разобраться в материале.

--- 
### Задание 3*

**Выполните действия, приложите скриншот скриптов, скриншот выполненного проекта.**

1. Добавить еще одну виртуальную машину.

#### Скриншот:

![8](https://github.com/yojihc/netology-Virtualization/blob/7-03/pics/08.png?raw=true)

#### Изменяем файл hosts

#### Скриншот:

![9](https://github.com/yojihc/netology-Virtualization/blob/7-03/pics/09.png?raw=true)


3. Установить на нее любую базу данных. 
4. Выполнить проверку состояния запущенных служб через Ansible.

#### Playdook mysqldb

```yaml
---
- name: Install MySQL Server
  hosts: sqldb
  vars:
    ansible_ssh_user: user
  become: yes

  tasks:
    - name: Update apt cache
      apt:
        update_cache: yes
      when: ansible_os_family == 'Debian'

    - name: Install MySQL Server
      apt:
        name: mysql-server
        state: present

    - name: Start MySQL Service
      service:
        name: mysql
        state: started

    - name: Ensure MySQL Service is enabled on boot
      service:
        name: mysql
        enabled: yes

    - name: Check if MySQL is running
      service:
        name: mysql
        state: started
      register: mysql_status
      ignore_errors: yes

    - name: Show MySQL service status
      debug:
        msg: "MySQL service is {{ 'running' if mysql_status.state == 'started' else 'not running' }}"
```

#### Скриншот успешного выполнения плейбука:

![10](https://github.com/yojihc/netology-Virtualization/blob/7-03/pics/10.png?raw=true)
--- 
### Задание 3*
Изучите [инструкцию](https://cloud.yandex.ru/docs/tutorials/infrastructure-management/terraform-quickstart) yandex для terraform.
Добейтесь работы паплайна с безопасной передачей токена от облака в terraform через переменные окружения. Для этого:

1. Настройте профиль для yc tools по инструкции.
2. Удалите из кода строчку "token = var.yandex_cloud_token". Terraform будет считывать значение ENV переменной YC_TOKEN.
3. Выполните команду export YC_TOKEN=$(yc iam create-token) и в том же shell запустите terraform.
4. Для того чтобы вам не нужно было каждый раз выполнять export - добавьте данную команду в самый конец файла ~/.bashrc

---

Дополнительные материалы: 

1. [Nginx. Руководство для начинающих](https://nginx.org/ru/docs/beginners_guide.html). 
2. [Руководство по Terraform](https://registry.terraform.io/providers/yandex-cloud/yandex/latest/doc). 
3. [Ansible User Guide](https://docs.ansible.com/ansible/latest/user_guide/index.html).
1. [Terraform Documentation](https://www.terraform.io/docs/index.html).

#### Скриншот:

![]()
