# Домашнее задание к занятию «Ansible.Часть 2»

---

### Задание 1

**Выполните действия, приложите файлы с плейбуками и вывод выполнения.**

Напишите три плейбука. При написании рекомендуем использовать текстовый редактор с подсветкой синтаксиса YAML.

Плейбуки должны: 

1. Скачать какой-либо архив, создать папку для распаковки и распаковать скаченный архив. Например, можете использовать [официальный сайт](https://kafka.apache.org/downloads) и зеркало Apache Kafka. При этом можно скачать как исходный код, так и бинарные файлы, запакованные в архив — в нашем задании не принципиально.
#### Code:

```yaml
---
- name: Download archive, create folder and extract it
  hosts: all
  become: yes

  tasks:
    - name: Create directory for extracted files
      file:
        path: /opt/kafka_extracted
        state: directory
        mode: '0755'

    - name: Download Apache Kafka archive
      get_url:
        url: https://archive.apache.org/dist/kafka/2.8.0/kafka_2.13-2.8.0.tgz
        dest: /tmp/kafka_archive.tgz
        mode: '0644'

    - name: Extract downloaded archive to created directory
      unarchive:
        src: /tmp/kafka_archive.tgz
        dest: /opt/kafka_extracted
        remote_src: yes
```

#### Скриншот:
![1](https://github.com/yojihc/netology-Virtualization/blob/7-01-part-2/pics/01.JPG?raw=true)

2. Установить пакет tuned из стандартного репозитория вашей ОС. Запустить его, как демон — конфигурационный файл systemd появится автоматически при установке. Добавить tuned в автозагрузку.

#### Code:
```yaml
---
- name: Install and enable tuned service
  hosts: all
  become: yes

  tasks:
    - name: Install tuned package
      apt:
        name: tuned
        state: present

    - name: Start tuned daemon
      service:
        name: tuned
        state: started
        enabled: yes

```

#### Скриншот:
![2](https://github.com/yojihc/netology-Virtualization/blob/7-01-part-2/pics/1-02.JPG?raw=true)
![2.1](https://github.com/yojihc/netology-Virtualization/blob/7-01-part-2/pics/1-02-2.JPG?raw=true)

3. Изменить приветствие системы (motd) при входе на любое другое. Пожалуйста, в этом задании используйте переменную для задания приветствия. Переменную можно задавать любым удобным способом.

```yaml
---
- name: Change MOTD message on login
  hosts: all
  become: yes

  vars:
    motd_message: "Welcome! This is your new Message of the Day."

  tasks:
    - name: Set MOTD with custom message
      copy:
        content: "{{ motd_message }}"
        dest: /etc/motd
        owner: root
        group: root
        mode: '0644'
```

#### Скриншот:
![3](https://github.com/yojihc/netology-Virtualization/blob/7-01-part-2/pics/1-03.JPG?raw=true)
![3.1](https://github.com/yojihc/netology-Virtualization/blob/7-01-part-2/pics/1-03-1.JPG?raw=true)



### Задание 2

**Выполните действия, приложите файлы с модифицированным плейбуком и вывод выполнения.** 

Модифицируйте плейбук из пункта 3, задания 1. В качестве приветствия он должен установить IP-адрес и hostname управляемого хоста, пожелание хорошего дня системному администратору. 

```yaml
---
- name: Modify MOTD with dynamic info
  hosts: all
  become: yes

  tasks:
    - name: Get host IP address
      ansible.builtin.shell: ip addr show scope global | grep inet | awk '{print $2}' | cut -f1 -d'/'
      register: ip_address

    - name: Set MOTD with IP and hostname
      copy:
        content: |
          Hello, System Administrator!
          Today's a great day to manage servers.
          Hostname: {{ ansible_hostname }}
          IP Address: {{ ip_address.stdout }}
        dest: /etc/motd
        owner: root
        group: root
        mode: '0644'

```

#### Скриншот:
![4](https://github.com/yojihc/netology-Virtualization/blob/7-01-part-2/pics/2-01.JPG?raw=true)
![4.1](https://github.com/yojihc/netology-Virtualization/blob/7-01-part-2/pics/2-01-1.JPG?raw=true)

### Задание 3

**Выполните действия, приложите архив с ролью и вывод выполнения.**

Ознакомьтесь со статьёй [«Ansible - это вам не bash»](https://habr.com/ru/post/494738/), сделайте соответствующие выводы и не используйте модули **shell** или **command** при выполнении задания.

Создайте плейбук, который будет включать в себя одну, созданную вами роль. Роль должна:

1. Установить веб-сервер Apache на управляемые хосты.
2. Сконфигурировать файл index.html c выводом характеристик каждого компьютера как веб-страницу по умолчанию для Apache. Необходимо включить CPU, RAM, величину первого HDD, IP-адрес.
Используйте [Ansible facts](https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_vars_facts.html) и [jinja2-template](https://linuxways.net/centos/how-to-use-the-jinja2-template-in-ansible/). Необходимо реализовать handler: перезапуск Apache только в случае изменения файла конфигурации Apache.
4. Открыть порт 80, если необходимо, запустить сервер и добавить его в автозагрузку.
5. Сделать проверку доступности веб-сайта (ответ 200, модуль uri).

В качестве решения:
- предоставьте плейбук, использующий роль;

#### Скриншот:
![5](https://github.com/yojihc/netology-Virtualization/blob/7-01-part-2/pics/3-04.PNG?raw=true)

- разместите архив созданной роли у себя на Google диске и приложите ссылку на роль в своём решении;

#### Ссылка:
[Link](https://disk.yandex.ru/d/yTIB-Rcub_mmHw)

- предоставьте скриншоты выполнения плейбука;

#### Скриншот:
![7](https://github.com/yojihc/netology-Virtualization/blob/7-01-part-2/pics/3-01.PNG?raw=true)

- предоставьте скриншот браузера, отображающего сконфигурированный index.html в качестве сайта.

#### Скриншот:
![8](https://github.com/yojihc/netology-Virtualization/blob/7-01-part-2/pics/3-02.PNG?raw=true)
![9](https://github.com/yojihc/netology-Virtualization/blob/7-01-part-2/pics/3-03.PNG?raw=true)

